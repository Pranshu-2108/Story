Chapter 4 of main branch.